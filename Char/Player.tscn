[gd_scene load_steps=22 format=3 uid="uid://1xwlmtgr22y3"]

[ext_resource type="Script" uid="uid://cb8ycc7d7cxo5" path="res://Char/Player.cs" id="1_i7lnh"]
[ext_resource type="AudioStream" uid="uid://bjn0u2adm77wi" path="res://Sounds/playerdeath.wav" id="2_4bnfu"]
[ext_resource type="PackedScene" uid="uid://d2o62y0ipeexj" path="res://Commons/FiniteStateMachine/FSM.tscn" id="2_v57ht"]
[ext_resource type="Script" uid="uid://cagfunlxupppg" path="res://Char/States/Playing.cs" id="4_nohbc"]
[ext_resource type="Texture2D" uid="uid://d0ul2eeifddcv" path="res://Art/player.png" id="4_pyd8o"]
[ext_resource type="PackedScene" uid="uid://cf5i24p68tfpj" path="res://Gun/GunManager.tscn" id="5_4ar4p"]
[ext_resource type="Script" uid="uid://b788dno4bfele" path="res://Char/Debug/DebugUi.cs" id="6_blmmp"]
[ext_resource type="Script" uid="uid://cbhcl5sqk8wna" path="res://Char/States/ExitingDoor.cs" id="7_4bgxc"]
[ext_resource type="Script" uid="uid://cc7ra3rsmfvv7" path="res://Char/Debug/DebugWindow.cs" id="7_j0qh7"]
[ext_resource type="Script" uid="uid://dsbs3e43hoxnh" path="res://Char/States/MiniGame.cs" id="7_pyd8o"]
[ext_resource type="PackedScene" uid="uid://bkm8ry2q5evix" path="res://UI/PlayerAnimationUI.tscn" id="7_v5cp3"]
[ext_resource type="PackedScene" uid="uid://dmnmypbmd1j2j" path="res://Commons/Components/HealthComponent.tscn" id="8_l20iv"]
[ext_resource type="PackedScene" uid="uid://bjlmwrshv4r7w" path="res://Commons/Components/HurtboxComponent.tscn" id="9_346cp"]
[ext_resource type="Script" uid="uid://be1wp1tngpcgs" path="res://Char/HeathContainer.cs" id="12_o15ra"]
[ext_resource type="PackedScene" uid="uid://g1tdo44o4lb" path="res://Char/HeartUI.tscn" id="13_o15ra"]
[ext_resource type="AudioStream" uid="uid://df0vo8wkmrux" path="res://Sounds/hitHurt2.wav" id="14_4bnfu"]

[sub_resource type="Animation" id="Animation_v5cp3"]
resource_name = "scale"
length = 0.6
loop_mode = 2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.566667),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(4, 4), Vector2(4.2, 4.2)]
}

[sub_resource type="Animation" id="Animation_jpifl"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(4, 4)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_jpifl"]
_data = {
&"RESET": SubResource("Animation_jpifl"),
&"scale": SubResource("Animation_v5cp3")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_col26"]
size = Vector2(25, 37)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_4bgxc"]
size = Vector2(32, 85)

[node name="Player" type="CharacterBody2D" node_paths=PackedStringArray("_imunityTimer") groups=["Player"]]
collision_layer = 32
collision_mask = 1153
collision_priority = 1.1
script = ExtResource("1_i7lnh")
Speed = 350.0
Acel = 150.0
Decel = 200.0
_hurtSound = ExtResource("14_4bnfu")
_deathSound = ExtResource("2_4bnfu")
_imunityTimer = NodePath("Timer")

[node name="Timer" type="Timer" parent="."]

[node name="HealthComponent" parent="." instance=ExtResource("8_l20iv")]
RoundToInt = true
MaxHealth = 3.0
Health = 3.0

[node name="GunManager" parent="." instance=ExtResource("5_4ar4p")]

[node name="Sprite2D" type="Sprite2D" parent="."]
scale = Vector2(4, 4)
texture = ExtResource("4_pyd8o")

[node name="AnimationPlayer" parent="Sprite2D" instance=ExtResource("7_v5cp3")]
libraries = {
&"": SubResource("AnimationLibrary_jpifl")
}
_animName = "scale"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-3.5, 25.5)
shape = SubResource("RectangleShape2D_col26")

[node name="FSM" parent="." instance=ExtResource("2_v57ht")]
InitialState = NodePath("Playing")

[node name="Playing" type="Node" parent="FSM"]
script = ExtResource("4_nohbc")

[node name="Dead" type="Node" parent="FSM"]

[node name="MiniGame" type="Node" parent="FSM"]
script = ExtResource("7_pyd8o")

[node name="Paused" type="Node" parent="FSM"]

[node name="ExitingDoor" type="Node" parent="FSM"]
script = ExtResource("7_4bgxc")

[node name="Timer" type="Timer" parent="FSM/ExitingDoor"]
wait_time = 0.06
one_shot = true

[node name="DebugUI" type="CanvasLayer" parent="."]
visible = false
script = ExtResource("6_blmmp")

[node name="Control" type="Control" parent="DebugUI"]
layout_mode = 3
anchors_preset = 0
offset_right = 632.0
offset_bottom = 372.0

[node name="DebugWindow" type="Panel" parent="DebugUI/Control" node_paths=PackedStringArray("_player", "_gun", "_bullet", "_button")]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("7_j0qh7")
_player = NodePath("PlayerDebug")
_gun = NodePath("GunDebug2")
_bullet = NodePath("BulletDebug3")
_button = NodePath("MenuButton")

[node name="PlayerDebug" type="Panel" parent="DebugUI/Control/DebugWindow"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="DebugUI/Control/DebugWindow/PlayerDebug"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -20.0
offset_right = 20.0
offset_bottom = 23.0
grow_horizontal = 2
text = "Player debug"

[node name="GunDebug2" type="Panel" parent="DebugUI/Control/DebugWindow"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="DebugUI/Control/DebugWindow/GunDebug2"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -41.0
offset_right = 41.0
offset_bottom = 23.0
grow_horizontal = 2
text = "GunDebug"

[node name="BulletDebug3" type="Panel" parent="DebugUI/Control/DebugWindow"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="DebugUI/Control/DebugWindow/BulletDebug3"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -20.0
offset_right = 20.0
offset_bottom = 23.0
grow_horizontal = 2
text = "BulletDebug"

[node name="MenuButton" type="MenuButton" parent="DebugUI/Control/DebugWindow"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -35.0
offset_top = -31.0
offset_right = 31.0
grow_horizontal = 2
grow_vertical = 0
text = "Press me"
item_count = 3
popup/item_0/text = "Player"
popup/item_0/id = 0
popup/item_1/text = "Gun"
popup/item_1/id = 1
popup/item_2/text = "Bullet"
popup/item_2/id = 2

[node name="HurtboxComponent" parent="." instance=ExtResource("9_346cp")]
position = Vector2(0, -12)
collision_layer = 32

[node name="CollisionShape2D" type="CollisionShape2D" parent="HurtboxComponent"]
position = Vector2(-3, 16.5)
shape = SubResource("RectangleShape2D_4bgxc")
debug_color = Color(0.787414, 0.161646, 0.962849, 0.42)

[node name="UI" type="CanvasLayer" parent="."]
layer = 0

[node name="UINode" type="Control" parent="UI"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="HeathContainer" type="HBoxContainer" parent="UI/UINode" node_paths=PackedStringArray("_player")]
layout_mode = 0
offset_right = 886.0
offset_bottom = 174.0
scale = Vector2(0.23, 0.23)
script = ExtResource("12_o15ra")
HeartScene = ExtResource("13_o15ra")
_player = NodePath("../../..")

[connection signal="timeout" from="Timer" to="." method="OnTimerTimeout"]
[connection signal="timeout" from="FSM/ExitingDoor/Timer" to="FSM/ExitingDoor" method="OnTimerTimeout"]
[connection signal="button_down" from="DebugUI/Control/DebugWindow/MenuButton" to="DebugUI/Control/DebugWindow" method="OnMenuButtonButtonDown"]
